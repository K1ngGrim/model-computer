<div class="min-h-screen bg-slate-900 text-slate-200 p-4 font-mono flex flex-col gap-4">

  <!-- HEADER -->
  <header class="bg-slate-800 p-4 rounded-lg shadow-lg border border-slate-700 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-emerald-400">4-Bit Modellrechner</h1>
      <p class="text-xs text-slate-400">UI Template</p>
    </div>

    <!-- Controls -->
    <div class="flex gap-2">
      <button (click)="reset()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-white text-sm transition-colors border border-slate-600">
        Reset
      </button>
      <button (click)="step()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white text-sm transition-colors font-bold shadow-lg shadow-blue-900/50">
        Step
      </button>
      <button (click)="toggleRun()" [class.bg-red-600]="isRunning()" [class.bg-emerald-600]="!isRunning()" class="px-4 py-2 hover:opacity-90 rounded text-white text-sm transition-colors font-bold w-24">
        {{ isRunning() ? 'Stop' : 'Run' }}
      </button>
    </div>
  </header>

  <!-- MAIN CONTENT GRID -->
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 flex-grow">

    <!-- LEFT: CODE EDITOR (Spalte 1-4) -->
    <div class="lg:col-span-4 flex flex-col gap-4">
      <!-- EDITOR COMPONENT (Spalte 1-5) -->
      <div #editormonaco style="width: 100%; height: 50%"></div>
    </div>

    <!-- CENTER: CPU & REGISTERS (Spalte 5-8) -->
    <div class="lg:col-span-4 flex flex-col gap-4">

      <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 shadow-lg relative overflow-hidden">
        <h2 class="text-sm font-bold text-slate-300 uppercase tracking-wider mb-6 border-b border-slate-700 pb-2">CPU Register</h2>

        <!-- Registers Grid -->
        <div class="grid grid-cols-2 gap-4 mb-6">

          <!-- PC -->
          <div class="bg-slate-900 p-3 rounded border border-slate-700 flex flex-col items-center">
            <span class="text-xs text-slate-500 font-bold mb-1">PC</span>
            <span class="text-2xl font-bold text-blue-400">{{ formatBin(cpu().pc) }}</span>
            <span class="text-xs text-slate-600 mt-1">Adr: {{ cpu().pc }}</span>
          </div>

          <!-- IR -->
          <div class="bg-slate-900 p-3 rounded border border-slate-700 flex flex-col items-center">
            <span class="text-xs text-slate-500 font-bold mb-1">Instruction (IR)</span>
            <!-- Hier kannst du deinen Opcode-Decoder aufrufen -->
            <span class="text-2xl font-bold text-purple-400">{{ formatHex(cpu().ir) }}</span>
            <span class="text-xs text-slate-600 mt-1">Opcode: {{ (shift(cpu().ir, 4)).toString(2) }}</span>
          </div>

          <!-- AKKU -->
          <div class="bg-slate-900 p-3 rounded border-2 border-emerald-500/50 flex flex-col items-center col-span-1 shadow-[0_0_15px_rgba(16,185,129,0.1)]">
            <span class="text-xs text-emerald-500 font-bold mb-1">AKKU</span>
            <span class="text-4xl font-bold text-emerald-400 font-mono">{{ formatBin(cpu().acc) }}</span>
            <span class="text-xs text-emerald-700 mt-1">Dez: {{ cpu().acc }} | Hex: {{ formatHex(cpu().acc) }}</span>
          </div>

          <!-- REGISTER B -->
          <div class="bg-slate-900 p-3 rounded border border-slate-600 flex flex-col items-center col-span-1">
            <span class="text-xs text-yellow-500 font-bold mb-1">REGISTER B</span>
            <span class="text-4xl font-bold text-yellow-400 font-mono">{{ formatBin(cpu().regB) }}</span>
            <span class="text-xs text-yellow-700 mt-1">Dez: {{ cpu().regB }} | Hex: {{ formatHex(cpu().regB) }}</span>
          </div>
        </div>

        <!-- Status Flags (Ampel) -->
        <div class="bg-slate-900 p-4 rounded-lg border border-slate-700 flex flex-col items-center">
          <span class="text-xs text-slate-500 font-bold mb-3 uppercase w-full text-center border-b border-slate-800 pb-2">Flags</span>
          <div class="flex justify-around w-full">

            <!-- Zero -->
            <div class="flex flex-col items-center gap-2">
              <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all duration-300"
                   [class.bg-blue-500]="cpu().flags.z"
                   [class.border-blue-400]="cpu().flags.z"
                   [class.shadow-[0_0_10px_#3b82f6]]="cpu().flags.z"
                   [class.bg-slate-800]="!cpu().flags.z"
                   [class.border-slate-600]="!cpu().flags.z">
                <span class="font-bold text-white text-xs">Z</span>
              </div>
              <span class="text-[10px] text-slate-500">Zero</span>
            </div>

            <!-- Carry -->
            <div class="flex flex-col items-center gap-2">
              <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all duration-300"
                   [class.bg-orange-500]="cpu().flags.c"
                   [class.border-orange-400]="cpu().flags.c"
                   [class.shadow-[0_0_10px_#f97316]]="cpu().flags.c"
                   [class.bg-slate-800]="!cpu().flags.c"
                   [class.border-slate-600]="!cpu().flags.c">
                <span class="font-bold text-white text-xs">C</span>
              </div>
              <span class="text-[10px] text-slate-500">Carry</span>
            </div>

            <!-- Negative -->
            <div class="flex flex-col items-center gap-2">
              <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all duration-300"
                   [class.bg-red-500]="cpu().flags.n"
                   [class.border-red-400]="cpu().flags.n"
                   [class.shadow-[0_0_10px_#ef4444]]="cpu().flags.n"
                   [class.bg-slate-800]="!cpu().flags.n"
                   [class.border-slate-600]="!cpu().flags.n">
                <span class="font-bold text-white text-xs">N</span>
              </div>
              <span class="text-[10px] text-slate-500">Neg</span>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: MEMORY (Spalte 9-12) -->
    <div class="lg:col-span-4 flex flex-col gap-4">

      <!-- Befehls-RAM -->
      <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 shadow-lg flex-1">
        <h2 class="text-sm font-bold text-slate-300 uppercase tracking-wider mb-2 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-blue-500"></span> Befehls-RAM
        </h2>
        <div class="grid grid-cols-1 text-xs font-mono border-t border-slate-700">
          <div *ngFor="let cell of instructionRam(); let i = index"
               class="flex items-center p-1 border-b border-slate-700 transition-colors"
               [class.bg-blue-900]="i === cpu().pc"
               [class.text-white]="i === cpu().pc"
               [class.text-slate-400]="i !== cpu().pc">
            <span class="w-6 text-slate-500 mr-2">{{ i.toString(10).padStart(2, '0') }}:</span>
            <span class="flex-grow font-bold tracking-widest">
                  {{ formatBin(shift(cell, 4)) }} | {{ formatBin(mask4Bit(cell)) }}
                </span>
            <span class="text-emerald-400 w-12 text-right">
                  Val: {{ cell }}
                </span>
          </div>
        </div>
      </div>

      <!-- Daten-RAM -->
      <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 shadow-lg flex-1">
        <h2 class="text-sm font-bold text-slate-300 uppercase tracking-wider mb-2 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-yellow-500"></span> Daten-RAM
        </h2>
        <div class="grid grid-cols-4 gap-2">
          <div *ngFor="let cell of dataRam(); let i = index"
               class="relative bg-slate-900 border border-slate-700 p-2 rounded flex flex-col items-center justify-center">
            <span class="absolute top-0 left-1 text-[9px] text-slate-600">{{ i }}</span>
            <span class="text-lg font-bold text-yellow-100 font-mono mt-1">{{ cell }}</span>
            <span class="text-[9px] text-slate-500">{{ formatBin(cell) }}</span>
          </div>
        </div>
      </div>

    </div>

  </div>

  <!-- Footer Output Log -->
  <div class="bg-slate-950 p-2 rounded border border-slate-800 text-xs font-mono text-slate-500 h-24 overflow-y-auto">
    <div *ngFor="let log of logs">{{ log }}</div>
  </div>

</div>
